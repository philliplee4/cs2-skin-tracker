<!DOCTYPE html>
<html>
<head><title>Debug Matching</title>
<style>body{background:#1a1d29;color:#e0e0e0;font-family:monospace;padding:20px}pre{background:#141722;padding:15px;border-radius:8px;overflow:auto}</style>
</head>
<body>
<h1>Debug Skinport Matching</h1>
<button onclick="debug()" style="padding:10px 20px;background:#667eea;color:white;border:none;border-radius:6px;cursor:pointer">Debug Now</button>
<pre id="output"></pre>

<script src="js/skinport-api.js"></script>
<script>
async function debug() {
  const out = document.getElementById('output');
  out.textContent = 'Loading...\n\n';

  const trackedItems = JSON.parse(localStorage.getItem('trackedItems') || '[]');
  out.textContent += 'Tracked Items: ' + trackedItems.length + '\n\n';

  trackedItems.forEach((item, i) => {
    out.textContent += 'Item ' + (i+1) + ': ' + item.weaponName + ' | ' + item.skinName + '\n';
    out.textContent += '  Min Price: ' + (item.minPrice || 'none') + '\n';
    out.textContent += '  Max Price: ' + (item.maxPrice || 'none') + '\n';
    out.textContent += '  Wear: ' + item.wearType + ' ' + (item.presetWear || '') + '\n';
    out.textContent += '  StatTrak: ' + item.stattrak + '\n';
    out.textContent += '  Status: ' + item.status + '\n\n';
  });

  out.textContent += 'Fetching Skinport items...\n';
  const skinportItems = await fetchSkinportItems();
  out.textContent += 'Got ' + skinportItems.length + ' items from Skinport\n\n';

  for (const item of trackedItems) {
    if (item.status !== 'tracking') continue;

    out.textContent += '\n=== Testing: ' + item.weaponName + ' | ' + item.skinName + ' ===\n';

    try {
      const matches = await findMatchingListings(item);
      out.textContent += 'Found ' + matches.length + ' matches\n';

      if (matches.length > 0) {
        matches.slice(0, 5).forEach(m => {
          const price = (m.min_price / 100).toFixed(2);
          out.textContent += '  - ' + m.market_hash_name + ': EUR ' + price + '\n';
        });
      } else {
        out.textContent += 'NO MATCHES! Checking why...\n';

        const nameMatches = skinportItems.filter(si => {
          const name = (si.market_hash_name || '').toLowerCase();
          return name.includes(item.weaponName.toLowerCase()) &&
                 name.includes(item.skinName.toLowerCase());
        });

        out.textContent += '  Items with matching name: ' + nameMatches.length + '\n';

        if (nameMatches.length > 0) {
          out.textContent += '  Sample items:\n';
          nameMatches.slice(0, 3).forEach(m => {
            const price = (m.min_price / 100).toFixed(2);
            out.textContent += '    - ' + m.market_hash_name + ': EUR ' + price + '\n';
          });
        }
      }
    } catch (e) {
      out.textContent += 'ERROR: ' + e.message + '\n';
      console.error(e);
    }
  }
}
</script>
</body>
</html>
